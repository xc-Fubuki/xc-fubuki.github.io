<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>字符串匹配：AC自动机 | 嘤嘤嘤</title><meta name="description" content="字符串匹配：AC自动机"><meta name="keywords" content="OI/ACM,算法,字符串"><meta name="author" content="Fubuki"><meta name="copyright" content="Fubuki"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="字符串匹配：AC自动机"><meta name="twitter:description" content="字符串匹配：AC自动机"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><meta property="og:type" content="article"><meta property="og:title" content="字符串匹配：AC自动机"><meta property="og:url" content="http://yoursite.com/2018/12/07/Algorithm-ACA/"><meta property="og:site_name" content="嘤嘤嘤"><meta property="og:description" content="字符串匹配：AC自动机"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://yoursite.com/2018/12/07/Algorithm-ACA/"><link rel="prev" title="快速傅里叶变换(FFT)" href="http://yoursite.com/2018/12/12/Fast-Fast-TLE/"><link rel="next" title="Algorithm-cdq" href="http://yoursite.com/2018/12/07/Algorithm-cdq/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://fubuki.cn/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  highlight_lang: 'true',
  highlight_shrink: 'true',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  copyright: undefined,
  copy_copyright_js: false,
  ClickShowText: undefined,
  medium_zoom: 'false',
  Snackbar: undefined
  
}</script><meta name="generator" content="Hexo 4.1.1"></head><body><div id="header"> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">嘤嘤嘤</a></span><i class="fa fa-bars fa-fw toggle-menu pull_right close" aria-hidden="true"></i><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></span><span class="pull_right" id="search_button"></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lazyload avatar_img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">42</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">79</div></a></div></div><div class="mobile_data_item is_center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">1</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Aho-Corasick-Automaton-·-AC自动机"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">Aho-Corasick Automaton · AC自动机</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Part-1-字典树-Trie"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">Part.1 - 字典树(Trie)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Part-2-看毛片-KMP"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">Part.2 - 看毛片(KMP)</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#·浅谈一发"><span class="toc_mobile_items-number">3.0.1.</span> <span class="toc_mobile_items-text">·浅谈一发</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#部分匹配值"><span class="toc_mobile_items-number">3.0.2.</span> <span class="toc_mobile_items-text">部分匹配值</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#部分匹配值的获取（get-next函数）"><span class="toc_mobile_items-number">3.0.3.</span> <span class="toc_mobile_items-text">部分匹配值的获取（get_next函数）</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#查找"><span class="toc_mobile_items-number">3.0.4.</span> <span class="toc_mobile_items-text">查找</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Part-3-AC自动机"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">Part.3 - AC自动机</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#关于AC自动机"><span class="toc_mobile_items-number">4.0.1.</span> <span class="toc_mobile_items-text">#关于AC自动机</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#·浅谈AC自动机-怎么现在才讲啊！"><span class="toc_mobile_items-number">4.0.2.</span> <span class="toc_mobile_items-text">·浅谈AC自动机(怎么现在才讲啊！)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#·实现"><span class="toc_mobile_items-number">4.0.3.</span> <span class="toc_mobile_items-text">·实现</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#构造Trie"><span class="toc_mobile_items-number">4.0.4.</span> <span class="toc_mobile_items-text">#构造Trie</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#画图构造失配边与后缀链接"><span class="toc_mobile_items-number">4.0.5.</span> <span class="toc_mobile_items-text">#画图构造失配边与后缀链接</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#匹配（查询）"><span class="toc_mobile_items-number">4.0.6.</span> <span class="toc_mobile_items-text">#匹配（查询）</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#最后贴上完整代码，写的很粗鲁大家见谅"><span class="toc_mobile_items-number">4.0.7.</span> <span class="toc_mobile_items-text">#最后贴上完整代码，写的很粗鲁大家见谅</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#·偷懒的我"><span class="toc_mobile_items-number">4.0.8.</span> <span class="toc_mobile_items-text">·偷懒的我</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#·写在后边"><span class="toc_mobile_items-number">4.0.9.</span> <span class="toc_mobile_items-text">·写在后边</span></a></li></ol></li></ol></li></ol></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Aho-Corasick-Automaton-·-AC自动机"><span class="toc-number">1.</span> <span class="toc-text">Aho-Corasick Automaton · AC自动机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Part-1-字典树-Trie"><span class="toc-number">2.</span> <span class="toc-text">Part.1 - 字典树(Trie)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Part-2-看毛片-KMP"><span class="toc-number">3.</span> <span class="toc-text">Part.2 - 看毛片(KMP)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#·浅谈一发"><span class="toc-number">3.0.1.</span> <span class="toc-text">·浅谈一发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#部分匹配值"><span class="toc-number">3.0.2.</span> <span class="toc-text">部分匹配值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#部分匹配值的获取（get-next函数）"><span class="toc-number">3.0.3.</span> <span class="toc-text">部分匹配值的获取（get_next函数）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查找"><span class="toc-number">3.0.4.</span> <span class="toc-text">查找</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Part-3-AC自动机"><span class="toc-number">4.</span> <span class="toc-text">Part.3 - AC自动机</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#关于AC自动机"><span class="toc-number">4.0.1.</span> <span class="toc-text">#关于AC自动机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#·浅谈AC自动机-怎么现在才讲啊！"><span class="toc-number">4.0.2.</span> <span class="toc-text">·浅谈AC自动机(怎么现在才讲啊！)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#·实现"><span class="toc-number">4.0.3.</span> <span class="toc-text">·实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#构造Trie"><span class="toc-number">4.0.4.</span> <span class="toc-text">#构造Trie</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#画图构造失配边与后缀链接"><span class="toc-number">4.0.5.</span> <span class="toc-text">#画图构造失配边与后缀链接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#匹配（查询）"><span class="toc-number">4.0.6.</span> <span class="toc-text">#匹配（查询）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#最后贴上完整代码，写的很粗鲁大家见谅"><span class="toc-number">4.0.7.</span> <span class="toc-text">#最后贴上完整代码，写的很粗鲁大家见谅</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#·偷懒的我"><span class="toc-number">4.0.8.</span> <span class="toc-text">·偷懒的我</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#·写在后边"><span class="toc-number">4.0.9.</span> <span class="toc-text">·写在后边</span></a></li></ol></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png)"><div id="post-info"><div id="post-title"><div class="posttitle">字符串匹配：AC自动机</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2018-12-07<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2019-12-19</time><div class="post-meta-wordcount"><i class="fa fa-eye post-meta__icon" aria-hidden="true">       </i><span>阅读量: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><p>18/12/07 修正</p>
<a id="more"></a>

<p>[TOC]</p>
<h2 id="Aho-Corasick-Automaton-·-AC自动机"><a href="#Aho-Corasick-Automaton-·-AC自动机" class="headerlink" title="Aho-Corasick Automaton · AC自动机"></a>Aho-Corasick Automaton · AC自动机</h2><p>AC自动机是一个高效的字符串多模匹配算法，它的核心想法是把KMP的失配指针做到Trie上，从而实现对于所有模板字符串而言的单次文本串扫描出结果。由此可见，若要整下AC自动机，必须先掌握Trie和KMP。</p>
<p><strong>注意！</strong>请务必仔细阅读并<del>深入</del>理解KMP，否则看AC机会有点困难</p>
<p>另外，AC自动机真的不是自动帮你AC的机子 <del>其实你可以找AK自动机</del>。</p>
<p>下文涉及的Trie以及KMP主要为AC自动机做铺垫，详细算法介绍请见相应文章。<del>KMP好像比较详细的呢</del></p>
<hr>
<h2 id="Part-1-字典树-Trie"><a href="#Part-1-字典树-Trie" class="headerlink" title="Part.1 - 字典树(Trie)"></a>Part.1 - 字典树(Trie)</h2><p>其实字典树、前缀树什么的是同一个东西。</p>
<p><img alt="这里写图片描述" data-src="https://www.z4a.net/images/2018/07/21/20180326195216730.png" class="lazyload"></p>
<p>不难看出，树上每个节点都对应了一个单词。Trie就是这样一颗多叉树（26叉较常用，图中省略了空子树），它的边用一个大小为26的数组记录，这样就可以实现O(1)向下查找。例如单词“tea”，它对应树中路径root (第零层) &gt; 1-1(第一层左往右第一个)  &gt; 2-2 &gt; 3-1 。</p>
<p>插入：从根开始，顺着边往下走（O(1)递进，实现见代码），当走到词的末位时标记当前节点</p>
<p>查询：从根开始，顺着边往下走（中途走不通视为查询失败），当走到词的末位时检查当前节点，确认是否被标记。</p>
<p>实现方法：<del>市面上</del> 有两种：数组模拟和充斥着指针的动态实现，建议初学者使用静态数组，dalao们请随意</p>
<p>代码<del>一言不合就封装</del>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Trie</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Nodes</span>	</span></span><br><span class="line"><span class="class">	&#123;</span></span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">		Nodes* nxt[<span class="number">26</span>];</span><br><span class="line">		<span class="keyword">bool</span> end;</span><br><span class="line">		Nodes()</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;++i)</span><br><span class="line">				nxt[i]=<span class="literal">NULL</span>;</span><br><span class="line">			end=<span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;++i)</span><br><span class="line">				nxt[i]=<span class="literal">NULL</span>;</span><br><span class="line">			end=<span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	Nodes root,*now;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	Trie()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">this</span>-&gt;root.init();</span><br><span class="line">		<span class="keyword">this</span>-&gt;now=<span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">this</span>-&gt;root.init();</span><br><span class="line">		<span class="keyword">this</span>-&gt;now=<span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!s)</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">this</span>-&gt;now=&amp;<span class="keyword">this</span>-&gt;root;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;s[i];++i)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">char</span> ch=(s[i]&gt;=<span class="string">'a'</span>&amp;&amp;s[i]&lt;=<span class="string">'z'</span>?s[i]-<span class="string">'a'</span>:s[i]-<span class="string">'A'</span>);<span class="comment">//假定大小写通用</span></span><br><span class="line">			<span class="comment">//一般情况下这样写： char ch=s[i]-'a';</span></span><br><span class="line">			<span class="keyword">if</span>(!<span class="keyword">this</span>-&gt;now-&gt;nxt[ch])</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>((<span class="keyword">this</span>-&gt;now-&gt;nxt[ch]=<span class="keyword">new</span> Nodes)==<span class="literal">NULL</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">return</span> <span class="number">-1</span>;<span class="comment">//申请内存失败，返回错误信息</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">this</span>-&gt;now=<span class="keyword">this</span>-&gt;now-&gt;nxt[ch];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">this</span>-&gt;now-&gt;end=<span class="literal">true</span>;<span class="comment">//标记单词末尾</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">find</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">this</span>-&gt;now=&amp;<span class="keyword">this</span>-&gt;root;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;s[i];++i)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">char</span> ch=(s[i]&gt;=<span class="string">'a'</span>&amp;&amp;s[i]&lt;=<span class="string">'z'</span>?s[i]-<span class="string">'a'</span>:s[i]-<span class="string">'A'</span>); </span><br><span class="line">			<span class="keyword">if</span>(!<span class="keyword">this</span>-&gt;now-&gt;nxt[ch])</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">this</span>-&gt;now=<span class="keyword">this</span>-&gt;now-&gt;nxt[ch];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>-&gt;now-&gt;end;</span><br><span class="line">	&#125;<span class="comment">/*</span></span><br><span class="line"><span class="comment">	~Trie()</span></span><br><span class="line"><span class="comment">	&#123;</span></span><br><span class="line"><span class="comment">	&#125;*/</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Part-2-看毛片-KMP"><a href="#Part-2-看毛片-KMP" class="headerlink" title="Part.2 - 看毛片(KMP)"></a>Part.2 - <del>看毛片</del>(KMP)</h2><p>看毛片算法至关重要，请务必仔细阅读并理解相应的内容。</p>
<h4 id="·浅谈一发"><a href="#·浅谈一发" class="headerlink" title="·浅谈一发"></a>·浅谈一发</h4><p>暴力求解时，有i指针在文章里，j指针在单词里，我们发现i和j总是在瞎jb乱跳。那么，能不能使其中一个递增，然后利用已有信息求出当前j的最大值呢？</p>
<p>假定我们有办法利用已有信息在log以内求出max(j)，那么匹配就很顺利了：当前位置匹配则长度+1，否则求解max(j)，后移j指针，直到j==0或者下一位匹配。</p>
<p>回到求解max(j)：</p>
<p>我们已有一段匹配的子串，长度为len，那么max(j)一定小于len(废话)。再进一步，设max(j)=k,那么s[1..k]=s[(j-k+1)..j]，否则k不合法。</p>
<p>观察：<code>s[1..k]=s[(j-k+1)..j]</code>，这不就是最长公共前后缀吗！</p>
<h4 id="部分匹配值"><a href="#部分匹配值" class="headerlink" title="部分匹配值"></a>部分匹配值</h4><p>· 我也不知道是不是这么叫，反正实际上是最长公共前后缀。</p>
<p>· 最长公共前后缀： 找到max(len)，使得字符串长度为len的前缀和后缀完全匹配。第三个栗子： ABCAB的最长公共前后缀为AB，len=2<br><del>算了还是说一下前缀和后缀吧：</del></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ABCBCD</span><br><span class="line">len     前缀         后缀</span><br><span class="line"> <span class="number">0</span>     (空串)       (空串)</span><br><span class="line"> <span class="number">1</span>     A            D</span><br><span class="line"> <span class="number">2</span>     AB           CD</span><br><span class="line"> <span class="number">3</span>     ABC          BCD</span><br><span class="line"> <span class="number">4</span>     ABCB         CBCD</span><br><span class="line"> <span class="number">5</span>     ABCBC        BCBCD</span><br><span class="line"> ......</span><br><span class="line"> <span class="number">6</span>     ABCBCD       ABCBCD</span><br></pre></td></tr></table></figure>

<p><del>（如果您还是不会，自行Ctrl+w并百度）</del></p>
<h4 id="部分匹配值的获取（get-next函数）"><a href="#部分匹配值的获取（get-next函数）" class="headerlink" title="部分匹配值的获取（get_next函数）"></a>部分匹配值的获取（get_next函数）</h4><p>· 惯例：如果你还不知道部分匹配值，请按Ctrl+w</p>
<p>next数组的意义：nxt[i]表示搜索词从开头（第零位）到第i位的部分匹配值</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mknxt</span><span class="params">(<span class="keyword">int</span> nxt[],<span class="keyword">int</span> lw,<span class="keyword">char</span> w[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> k=<span class="number">0</span>,i=<span class="number">1</span>;<span class="comment">//k是上一次的匹配值，i务必从1开始</span></span><br><span class="line">	<span class="keyword">for</span>(k=<span class="number">0</span>,i=<span class="number">1</span>;i&lt;lw;++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">while</span>(k&gt;<span class="number">0</span>&amp;&amp;w[i]!=w[k])<span class="comment">//k&gt;0不解释，w[i]!=w[k]即当前匹配不成功</span></span><br><span class="line">			k=nxt[k<span class="number">-1</span>];<span class="comment">//我也不想解释，可就是难解释啊</span></span><br><span class="line">		<span class="keyword">if</span>(w[i]==w[k])<span class="comment">//当前位置匹配成功</span></span><br><span class="line">			k++;</span><br><span class="line">		nxt[i]=k;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当前位置匹配成功的操作很好理解，k+1即可。<br>关键在于不相等的情况：k=nxt[k-1]是什么鬼！</p>
<p><img alt data-src="https://www.z4a.net/images/2018/07/21/20180506153217645.png" class="lazyload"></p>
<p>w[k]与w[i]不等的处理方法：显然长度为k的前后缀是不能用了，所以应当去考虑短一点的前后缀。展开图中大条子，出现上下两个小条子，小条子的结构也是绿黄绿，而且(1-1)=(1-2),(2-1)=(2-2)。我们知道(大条子绿色前缀)=(大条子绿色后缀)，所以(1-1)=(1-2)=(2-1)=(2-2)。然后执行k=nxt[k-1]，原图变为：</p>
<p><img alt="这里写图片描述" data-src="https://www.z4a.net/images/2018/07/21/20180506154939290.png" class="lazyload"></p>
<p>现在，大条子中的绿色部分已经缩短，k的值改变为原来的nxt[k-1]。再次检查w[k]和w[i]。</p>
<h4 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">KMP</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>,k=<span class="number">0</span>;i&lt;ls;++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">while</span>(k&gt;<span class="number">0</span>&amp;&amp;w[k]!=s[i])</span><br><span class="line">			k=nxt[k<span class="number">-1</span>];</span><br><span class="line">		<span class="keyword">if</span>(w[k]==s[i])</span><br><span class="line">			k++;</span><br><span class="line">		<span class="keyword">if</span>(k==lw)</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Pattern occurs with shift:%d\n"</span>,(i-lw+<span class="number">1</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果你看懂了next数组的构造，这里也就不需要解释了</p>
<hr>
<h2 id="Part-3-AC自动机"><a href="#Part-3-AC自动机" class="headerlink" title="Part.3 - AC自动机"></a>Part.3 - AC自动机</h2><p>当需要找的东西太多时，KMP就显得很磨叽（需要对每一个模板串构造一次nxt数组并在所有文本串中找一次），因此引入AC自动机。</p>
<h4 id="关于AC自动机"><a href="#关于AC自动机" class="headerlink" title="#关于AC自动机"></a>#关于AC自动机</h4><p><del>当然是自动帮你AC题目的机器啦</del></p>
<p>一种多模式串匹配算法，该算法在1975年产生于贝尔实验室，是著名的多模式匹配算法之一。</p>
<p>有限状态自动机中最简单的一种。</p>
<p><img alt="这里写图片描述" data-src="https://www.z4a.net/images/2018/07/21/20180331133525590.jpg" class="lazyload"></p>
<h4 id="·浅谈AC自动机-怎么现在才讲啊！"><a href="#·浅谈AC自动机-怎么现在才讲啊！" class="headerlink" title="·浅谈AC自动机(怎么现在才讲啊！)"></a>·浅谈AC自动机(怎么现在才讲啊！)</h4><p>某dalao：AC自动机就是爬到树上看毛片。</p>
<p>dalao说的很好！<del>但是看毛片是违法的</del> AC自动机实际上是把KMP与Trie结合，将KMP中的next转变为fail指针挂到Trie上。</p>
<p>显然，在KMP匹配的过程中，i指针<strong>递增</strong>，j指针(已匹配的末位)总是在”乱跳”。AC自动机的匹配过程如KMP类似，i指针递增，j指针在图上跳。</p>
<p>我们的目的是最大化当前匹配部分，也就是最大化j的值(在Trie上是节点深度)。</p>
<p>来回顾KMP：j+1与i不匹配时，借助next数组前推j指针，使得j’最大。</p>
<p>KMP是仅有一个单词的情况，那么当单词有多个呢？</p>
<p>显然，我们可以在别的单词里去找next。这时next已经被做成指针了，也就是fail(也叫失配边)</p>
<p>假设我们已经求得fail指针，那么接下来要做的是匹配。</p>
<p>与KMP类似，若新字符匹配成功则j指针下移一层，否则j不断沿着失配边走下去，直到j的深度为0(root)，或者下一位成功匹配。</p>
<p>由于单词有多个，可能存在s为t的后缀的情况，因此追加一个后缀链接方便查找。</p>
<p>再举个例子：</p>
<p>现有单词：{“SAY”,”SHE”,”SHR”,”HER”}</p>
<p>首先构造出Trie如图：</p>
<p><img alt data-src="https://www.z4a.net/images/2018/08/03/11.md.png" class="lazyload"></p>
<p>接下来从第一层开始构造失配边(红色边)：</p>
<p>由于到这一层的串再Trie中均没有合法的后缀，故把这一层所有点的失配边指回Root(可以理解为空串是其合法后缀)</p>
<p><img alt data-src="https://www.z4a.net/images/2018/08/03/12.md.png" class="lazyload"></p>
<hr>
<p>第二层，出现了”H”是当前”SH”的后缀，将第二层’H’点的失配边指向第一层的’H’，其余节点的fail指回Root</p>
<p><img alt data-src="https://www.z4a.net/images/2018/08/03/13.md.png" class="lazyload"></p>
<hr>
<p>第三层，出现了”HE”是”SHE”的后缀，将第三层’E’的fail指向第二层’E’。</p>
<p>这时，虽然有”R”是”SHR”的后缀，但是”R”并不是一个从Root开始的合法串，故仍将’R’的失配边指向Root</p>
<p><img alt data-src="https://www.z4a.net/images/2018/08/03/14.md.png" class="lazyload"></p>
<p>接下来开始实现：</p>
<h4 id="·实现"><a href="#·实现" class="headerlink" title="·实现"></a>·实现</h4><h4 id="构造Trie"><a href="#构造Trie" class="headerlink" title="#构造Trie"></a>#构造Trie</h4><p>将模板串全部读入并构造Trie，这里需要在之前的Trie基础上新增last和fail指针，前者叫做后缀链接（后头再解释），后者就是失配边。</p>
<h4 id="画图构造失配边与后缀链接"><a href="#画图构造失配边与后缀链接" class="headerlink" title="#画图构造失配边与后缀链接"></a>#<del>画图</del>构造失配边与后缀链接</h4><p>失配边类似于KMP中的next，实际上指向了一个串的后缀(只需要满足后缀的关系就行)，有了这玩意儿可以极大的方便查找；</p>
<p>后缀链接指向串的后缀（废话）且<strong>该后缀是一个完整的单词</strong>。后缀链接的作用很显然，如果有{“fubuki”,”ki”}，某时刻已经找到了”fubuki”，那么顺着后缀链接就能找到”ki”，这样一来，后缀链接就可以进行递归累计。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ACA</span><span class="params">()</span><span class="comment">//BFS构造失配边</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">queue</span>&lt;Trie*&gt;que;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;++i)</span><br><span class="line">	&#123;</span><br><span class="line">		now=root.nxt[i];</span><br><span class="line">		<span class="keyword">if</span>(now)</span><br><span class="line">		&#123;</span><br><span class="line">			que.push(now);</span><br><span class="line">			now-&gt;f=&amp;root;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="comment">//初始化队列</span></span><br><span class="line">	<span class="keyword">while</span>(!que.empty())</span><br><span class="line">	&#123;<span class="comment">//逐层构造</span></span><br><span class="line">		Trie *hed=que.front();</span><br><span class="line">		que.pop();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;++i)</span><br><span class="line">		&#123;<span class="comment">//构造对于now-&gt;nxt[i]的fail与last</span></span><br><span class="line">			Trie *j=hed-&gt;f;</span><br><span class="line">			now=hed-&gt;nxt[i];</span><br><span class="line">			<span class="keyword">if</span>(!now)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>(j)</span><br><span class="line">					hed-&gt;nxt[i]=j-&gt;nxt[i];<span class="comment">//这句过会儿解释，请暂忽略</span></span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			que.push(now);</span><br><span class="line">			<span class="keyword">while</span>(j&amp;&amp;!j-&gt;nxt[i])<span class="comment">//从hed-&gt;f的基础上获取hed-&gt;nxt[i]-&gt;f，找一个hed的后缀，且这个后缀的后一个字符为i</span></span><br><span class="line">				j=j-&gt;f;</span><br><span class="line"><span class="comment">/* &lt;???&gt;"*********"'字符' hed-&gt;nxt[i]对应的串(双引号内为已经确定fail的部分)和当前字符</span></span><br><span class="line"><span class="comment">   "*********"'未知字符' hed-&gt;f对应的串及其下一个字符(未知)</span></span><br><span class="line"><span class="comment">   显然，两端中双引号内字符串完全匹配，只需考虑二者的下一个字符是否相等</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">			<span class="keyword">if</span>(j)<span class="comment">//数组版无需判断，这里是指针防越界（空指针）</span></span><br><span class="line">			&#123;</span><br><span class="line">				now-&gt;f=j-&gt;nxt[i];</span><br><span class="line">				now-&gt;lst=now-&gt;f-&gt;flg?now-&gt;f:now-&gt;f-&gt;lst;<span class="comment">//如果失配边指向一个单词就直接记录lst,否则看看失配边指向的lst</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(!now-&gt;f)<span class="comment">//空串是任意串的后缀，无法构造fail的就指回root Ps.数组版还是不需要。。。</span></span><br><span class="line">				now-&gt;f=&amp;root;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="匹配（查询）"><a href="#匹配（查询）" class="headerlink" title="#匹配（查询）"></a>#匹配（查询）</h4><p>与KMP的Find相差无几，只不过由推动下标变为推动节点指针</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">find</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	now=&amp;root;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;s[i];++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> j=s[i]-<span class="string">'a'</span>;</span><br><span class="line">		<span class="keyword">while</span>(now&amp;&amp;!now-&gt;nxt[j])<span class="comment">//如果当前节点没有儿子i就顺着失配边走直到新节点有儿子i或走回root</span></span><br><span class="line">			now=now-&gt;f;</span><br><span class="line">		<span class="keyword">if</span>(now)<span class="comment">//再次防越界（空指针）</span></span><br><span class="line">		&#123;</span><br><span class="line">			now=now-&gt;nxt[j];<span class="comment">//相当于KMP里的指针后移</span></span><br><span class="line">			<span class="keyword">if</span>(now-&gt;flg)<span class="comment">//当前节点记录了单词</span></span><br><span class="line">				count(now);<span class="comment">//递归累加出现次数</span></span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(now-&gt;lst)<span class="comment">//当前串的后缀可能是个单词</span></span><br><span class="line">				count(now-&gt;lst);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span><span class="comment">//now为空意味着走回root</span></span><br><span class="line">			now=&amp;root;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*构造失配边时有一句：hed-&gt;nxt[i]=j-&gt;nxt[i];</span></span><br><span class="line"><span class="comment">实际上是加上一条不存在的边，把nxt[i]变成了另一个fail指针</span></span><br><span class="line"><span class="comment">如果构造时写了这句话，匹配的时候就无需写while(now&amp;&amp;!now-&gt;nxt[j])了*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">count</span><span class="params">(Trie *now)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!now)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	cnt[now-&gt;flg]++;</span><br><span class="line">	count(now-&gt;lst);<span class="comment">//当前串的后缀可能又是一个单词</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="最后贴上完整代码，写的很粗鲁大家见谅"><a href="#最后贴上完整代码，写的很粗鲁大家见谅" class="headerlink" title="#最后贴上完整代码，写的很粗鲁大家见谅"></a>#最后贴上完整代码，写的很粗鲁大家见谅</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n,m,cnt[<span class="number">1005</span>];</span><br><span class="line"><span class="keyword">char</span> s[<span class="number">1005</span>];<span class="comment">//不要在意大小</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Trie</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	Trie *nxt[<span class="number">26</span>],*f,*lst;</span><br><span class="line">	<span class="keyword">int</span> flg;</span><br><span class="line">	Trie()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;++i)</span><br><span class="line">			nxt[i]=<span class="literal">NULL</span>;</span><br><span class="line">		f=lst=<span class="literal">NULL</span>;</span><br><span class="line">		flg=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;root,*now;<span class="comment">//Trie</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">count</span><span class="params">(Trie *now)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!now)<span class="comment">//</span></span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	cnt[now-&gt;flg]++;</span><br><span class="line">	count(now-&gt;lst);</span><br><span class="line">&#125;<span class="comment">//累计答案用的，不同题目会要求不同答案</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">find</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	now=&amp;root;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;s[i];++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> j=s[i]-<span class="string">'a'</span>;</span><br><span class="line">		<span class="keyword">while</span>(now&amp;&amp;!now-&gt;nxt[j])</span><br><span class="line">			now=now-&gt;f;</span><br><span class="line">		<span class="keyword">if</span>(now)</span><br><span class="line">		&#123;</span><br><span class="line">			now=now-&gt;nxt[j];</span><br><span class="line">			<span class="keyword">if</span>(now-&gt;flg)</span><br><span class="line">				count(now);</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(now-&gt;lst)</span><br><span class="line">				count(now-&gt;lst);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			now=&amp;root;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ACA</span><span class="params">()</span><span class="comment">//BFS构造失配边</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">queue</span>&lt;Trie*&gt;que;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;++i)</span><br><span class="line">	&#123;</span><br><span class="line">		now=root.nxt[i];</span><br><span class="line">		<span class="keyword">if</span>(now)</span><br><span class="line">		&#123;</span><br><span class="line">			que.push(now);</span><br><span class="line">			now-&gt;f=&amp;root;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span>(!que.empty())</span><br><span class="line">	&#123;</span><br><span class="line">		Trie *hed=que.front();</span><br><span class="line">		que.pop();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;++i)</span><br><span class="line">		&#123;</span><br><span class="line">			Trie *j=hed-&gt;f;</span><br><span class="line">			now=hed-&gt;nxt[i];</span><br><span class="line">			<span class="keyword">if</span>(!now)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>(j)</span><br><span class="line">					hed-&gt;nxt[i]=j-&gt;nxt[i];</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			que.push(now);</span><br><span class="line">			<span class="keyword">while</span>(j&amp;&amp;!j-&gt;nxt[i])</span><br><span class="line">				j=j-&gt;f;</span><br><span class="line">			<span class="keyword">if</span>(j)</span><br><span class="line">			&#123;</span><br><span class="line">				now-&gt;f=j-&gt;nxt[i];</span><br><span class="line">				now-&gt;lst=now-&gt;f-&gt;flg?now-&gt;f:now-&gt;f-&gt;lst;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(!now-&gt;f)</span><br><span class="line">				now-&gt;f=&amp;root;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	freopen(<span class="string">"test.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</span><br><span class="line">	freopen(<span class="string">"test.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">	&#123;</span><br><span class="line">		now=&amp;root;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%s"</span>,s);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;s[j];++j)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(!now-&gt;nxt[s[j]-<span class="string">'a'</span>])</span><br><span class="line">				now-&gt;nxt[s[j]-<span class="string">'a'</span>]=<span class="keyword">new</span> Trie;</span><br><span class="line">			now=now-&gt;nxt[s[j]-<span class="string">'a'</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		now-&gt;flg=i;</span><br><span class="line">	&#125;</span><br><span class="line">	ACA();</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%s"</span>,s);</span><br><span class="line">		find();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%d "</span>,cnt[i]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="·偷懒的我"><a href="#·偷懒的我" class="headerlink" title="·偷懒的我"></a>·偷懒的我</h4><p>为啥AC自动机写的比KMP短？        ——你都理解KMP了，上树不就行了吗！</p>
<hr>
<h4 id="·写在后边"><a href="#·写在后边" class="headerlink" title="·写在后边"></a>·写在后边</h4><p>如果哪一位dalao会 AK自动机 请尽快联系本蒟蒻，必有重谢！</p>
<p>本文多有不妥之处，欢迎批评指正！</p>
<p><del>本文不会有人转的。。。</del>转载请注明出处。</p>
<p>参考：</p>
<p>刘汝佳《算法竞赛入门经典（训练指南）》</p>
<p>徐玄長(好吧我自己)《KMP·看毛片》</p>
</div></article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/OI-ACM/">OI/ACM    </a><a class="post-meta__tags" href="/tags/%E7%AE%97%E6%B3%95/">算法    </a><a class="post-meta__tags" href="/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/">字符串    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2018/12/12/Fast-Fast-TLE/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>快速傅里叶变换(FFT)</span></div></a></div><div class="next-post pull_right"><a href="/2018/12/07/Algorithm-cdq/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>Algorithm-cdq</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2018/05/06/Algorithm-KMP/" title="字符串匹配：KMP算法"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><div class="relatedPosts_title">字符串匹配：KMP算法</div></a></div><div class="relatedPosts_item"><a href="/2018/12/07/Algorithm-cdq/" title="Algorithm-cdq"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><div class="relatedPosts_title">Algorithm-cdq</div></a></div><div class="relatedPosts_item"><a href="/2018/05/26/HNOI2004-Lyuyan-sol/" title="HNOI2004 L语言 Sol"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><div class="relatedPosts_title">HNOI2004 L语言 Sol</div></a></div><div class="relatedPosts_item"><a href="/2019/03/01/SAM-Code/" title="后缀自动机-板子"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><div class="relatedPosts_title">后缀自动机-板子</div></a></div><div class="relatedPosts_item"><a href="/2019/02/27/NOI2015-品酒大会/" title="NOI2015-品酒大会"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><div class="relatedPosts_title">NOI2015-品酒大会</div></a></div><div class="relatedPosts_item"><a href="/2019/02/11/Suffix-Sort/" title="后缀排序(板子)"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><div class="relatedPosts_title">后缀排序(板子)</div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = false == true ? true : false;
var verify = false == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'8mlkXCrYVtzGATsvmu5eUycM-gzGzoHsz',
  appKey:'JfKTajHhzULTBgiJey5tUfJs',
  placeholder:'Please leave your footprints',
  avatar:'identicon',
  guest_info:guest_info,
  pageSize:'10',
  lang:'zh-cn',
  recordIP: true
});</script></div></div></div><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By Fubuki</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">简</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="/js/tw_cn.js"></script><script>translateInitilization()
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>